<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nelbosco.mapper.ReleaseMapper">

	<sql id="ReleaseColumns">
		 id, 
		 writer,
		 title, 
		 content, 
		 img_saved, 
		 img_original, 
		 insert_date, 
		 modified_date, 
		 division,
		 notice_yn,
		 secret_yn, 
		 create_ip,
		 modify_ip
	</sql>

	<insert id="insertRelease" parameterType="com.nelbosco.domain.ReleaseDTO" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tb_release (
			 writer,
			 title, 
			 content, 
			 img_saved, 
			 img_original, 
			 insert_date, 
			 modified_date, 
			 division,
			 notice_yn,
			 secret_yn,
			 create_ip, 
			 modify_ip
		) VALUES (
			  #{writer}
			, #{title}
			, #{content}
			, #{imgSaved}
			, #{imgOriginal}
			, NOW()
			, NOW()		
			, #{division}
			, IFNULL(#{noticeYn}, 'N')
			, IFNULL(#{secretYn}, 'N')
			, #{createIp}
			, #{modifyIp}			
		)
	</insert>
	
	<select id="selectAllReleases" resultType="com.nelbosco.domain.ReleaseDTO"  parameterType="com.nelbosco.domain.ReleaseDTO">
		SELECT
			<include refid="ReleaseColumns" />
		FROM
			tb_release
		WHERE
			delete_yn = 'N'		
		<include refid="CommonMapper.search" />
		ORDER BY
			id DESC,
			insert_date DESC
		<include refid="CommonMapper.paging" />
	</select>

	<select id="selectReleaseDetail" parameterType="long" resultType="com.nelbosco.domain.ReleaseDTO">
		SELECT
			<include refid="ReleaseColumns" />
		FROM
			tb_release
		WHERE
			delete_yn = 'N'
		AND
			id = #{id}
	</select>
	
	<select id="selectTotalCount" parameterType="com.nelbosco.domain.ReleaseDTO" resultType="int">
		SELECT
			count(*)
		FROM
			tb_release
		WHERE
			delete_yn = 'N'		
		<include refid="CommonMapper.search" />
	</select>
	
	
	<update id="updateRelease" parameterType="com.nelbosco.domain.ReleaseDTO">
	    UPDATE tb_release
	    SET
	        title = #{title},
	        content = #{content},
	        modified_date = NOW(),
	        division = #{division},
	        notice_yn = IFNULL(#{noticeYn}, 'N'),
	        secret_yn = IFNULL(#{secretYn}, 'N'),
	        modify_ip = #{modifyIp}
	    WHERE id = #{id}
	</update>
	
	<update id="deleteRelease" parameterType="long">
	    UPDATE tb_release
	    SET
	        delete_yn = 'Y'
	    WHERE id = #{id}
	</update>
	
	<update id="updateReleaseOpenState"  parameterType="com.nelbosco.domain.ReleaseDTO">
	    UPDATE tb_release
	    SET
            notice_yn = #{noticeYn},
	        secret_yn = #{secretYn}
	    WHERE id = #{id}
	</update>
</mapper>